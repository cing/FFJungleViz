<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="name" content="Force Field Jungle Viz" />
    <meta name="description" content="Visualization of the force field comparison literature"/>
    <meta name="mintags" content="2" />
    <meta name="maxtags" content="2" />
    <title>Force Field Jungle Viz</title>

    <style>
        @import url(ffjungle.css);
    </style>
</head>
<body>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script>
//
// Based on a visualization by Dustin Spicuzza <dustin@virtualroadside.com>
// Inspired by http://www.findtheconversation.com/concept-map/
// Loosely based on http://bl.ocks.org/mbostock/4063550
//

rawdata = {
    "papers": [
        {
            "type": "paper",
            "name": "Shirts et al. (2003)",
            "url": "https://dx.doi.org/10.1063/1.1587119",
            "title": "Extremely precise free energy calculations of amino acid side chain analogs: Comparison of common molecular mechanics force fields for proteins",
            "journal": "J. Chem. Phys. 119, 5740 (2003)",
            "description": "...",
            "ditem": 1,
            "date": "2003-01-01",
            "slug": "shirts2003",
            "forcefields": ["AMBER94", "CHARMM22", "OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Hornak et al. (2006)",
            "url": "...",
            "title": "Comparison of multiple AMBER force fields and development of improved protein backbone parameters",
            "journal": "...",
            "description": "...",
            "ditem": 2,
            "date": "2006-01-01",
            "slug": "hornak2006",
            "forcefields": ["AMBER99SB","AMBER03","AMBER94","AMBER99","AMBER99φ"]
        },
        {
            "type": "paper",
            "name": "Best et al. (2008)",
            "url": "...",
            "title": "Extremely precise free energy calculations of amino acid side chain analogs: Comparison of common molecular mechanics force fields for proteins",
            "journal": "...",
            "description": "...",
            "ditem": 3,
            "date": "2008-01-01",
            "slug": "best2008",
            "forcefields": ["AMBER03*", "AMBER99SB", "AMBERGS", "OPLS-AA/L", "GROMOS53a6", "GROMOS43a1"]
        },
        {
            "type": "paper",
            "name": "Lange et al. (2010)",
            "url": "...",
            "title": "Scrutinizing Molecular Mechanics Force Fields on the Submicrosecond Timescale with NMR Data",
            "journal": "...",
            "description": "...",
            "ditem": 4,
            "date": "2010-01-01",
            "slug": "lange2010",
            "forcefields": ["OPLS-AA/L", "AMBER99SB", "AMBER03", "CHARMM22", "GROMOS43a1","GROMOS53a6"]
        },
        {
            "type": "paper",
            "name": "Florová et al. (2010)",
            "url": "...",
            "title": "Explicit Water Models Affect the Specific Solvation and Dynamics of Unfolded Peptides While the Conformational Behavior and Flexibility of Folded Peptides Remain Intact",
            "journal": "J. Chem. Theory Comput. 6, 3569–3579 (2010)",
            "description": "...",
            "ditem": 5,
            "date": "2010-01-01",
            "slug": "florova2010",
            "forcefields": ["AMBER99","AMBER99SB","AMBER03"]
        },
        {
            "type": "paper",
            "name": "Piana et al. (2011)",
            "url": "...",
            "title": "How Robust Are Protein Folding Simulations with Respect to Force Field Parameterization?",
            "journal": "...",
            "description": "...",
            "ditem": 6,
            "date": "2011-01-01",
            "slug": "piana2011",
            "forcefields": ["AMBER03", "AMBER99SB*-ILDN", "CHARMM22-CMAP", "CHARMM22*"]
        },
        {
            "type": "paper",
            "name": "Beauchamp et al. (2012)",
            "url": "...",
            "title": "Are Protein Force Fields Getting Better? A Systematic Benchmark on 524 Diverse NMR Measurements",
            "journal": "...",
            "description": "...",
            "ditem": 7,
            "date": "2012-01-01",
            "slug": "beauchamp2012",
            "forcefields": ["AMBER96", "AMBER99", "AMBER03", "AMBER03W", "AMBER03*", "AMBER99SB*", "AMBER99SB-ILDN","AMBER99SB-ILDN-phi","AMBER99SB-ILDN-NMR","CHARMM22-CMAP","OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Cino et al. (2012)",
            "url": "...",
            "title": "Comparison of Secondary Structure Formation Using 10 Different Force Fields in Microsecond Molecular Dynamics Simulations",
            "journal": "...",
            "description": "...",
            "ditem": 8,
            "date": "2012-01-01",
            "slug": "beauchamp2012",
            "forcefields": ["AMBER99SB-ILDN", "AMBER99SB", "AMBER99SB*", "AMBER03", "AMBER03*","GROMOS43a1","GROMOS53a6","CHARMM22-CMAP","OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Lindorff-Larsen et al. (2012)",
            "url": "...",
            "title": "Systematic Validation of Protein Force Fields against Experimental Data",
            "journal": "...",
            "description": "...",
            "ditem": 9,
            "date": "2012-01-01",
            "slug": "lindorfflarsen2012",
            "forcefields": ["AMBER99SB-ILDN", "AMBER99SB*-ILDN", "AMBER03", "AMBER03*", "OPLS-AA/L", "CHARMM22", "CHARMM22-CMAP","CHARMM22*"]
        },
        {
            "type": "paper",
            "name": "Best et al. (2012)",
            "url": "...",
            "title": "Optimization of the Additive CHARMM All-Atom Protein Force Field Targeting Improved Sampling of the Backbone φ,ψ and Side-Chain χ1 and χ2 Dihedral Angles",
            "journal": "...",
            "description": "...",
            "ditem": 10,
            "date": "2012-01-01",
            "slug": "best2012",
            "forcefields": ["AMBER99SB-ILDN","AMBER99SB","AMBER99SB*","CHARMM22-CMAP","CHARMM36","OPLS-AA/L","GROMOS53a6"]
        },
        {
            "type": "paper",
            "name": "Huang et al. (2013)",
            "url": "...",
            "title": "CHARMM36 All-Atom Additive Protein Force Field: Validation Based on Comparison to NMR Data",
            "journal": "...",
            "description": "...",
            "ditem": 11,
            "date": "2013-01-01",
            "slug": "huang2013",
            "forcefields": ["CHARMM36","CHARMM22-CMAP"]
        },
        {
            "type": "paper",
            "name": "Shi et al. (2013)",
            "url": "...",
            "title": "Polarizable Atomic Multipole-Based AMOEBA Force Field for Proteins",
            "journal": "...",
            "description": "...",
            "ditem": 12,
            "date": "2013-01-01",
            "slug": "shi2013",
            "forcefields": ["AMOEBA","AMBER99SB","AMBER99SB-ILDN"]
        },
        {
            "type": "paper",
            "name": "Petrov et al. (2014)",
            "url": "...",
            "title": "Are Current Atomistic Force Fields Accurate Enough to Study Proteins in Crowded Environments?",
            "journal": "...",
            "description": "...",
            "ditem": 13,
            "date": "2014-01-01",
            "slug": "petrov2014",
            "forcefields": ["GROMOS45a3", "GROMOS54a7", "AMBER99SB-ILDN", "CHARMM22-CMAP","AMBER94","OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Palazzesi et al. (2014)",
            "url": "...",
            "title": "Accuracy of Current All-Atom Force-Fields in Modeling Protein Disordered States",
            "journal": "...",
            "description": "...",
            "ditem": 14,
            "date": "2014-01-01",
            "slug": "palazzesi2014",
            "forcefields": ["AMBER99SB*-ILDN", "CHARMM22*", "AMBER03W"]
        },
        {
            "type": "paper",
            "name": "Best et al. (2014)",
            "url": "...",
            "title": "Balanced Protein−Water Interactions Improve Properties of Disordered Proteins and Non-Specific Protein Association",
            "journal": "...",
            "description": "...",
            "ditem": 15,
            "date": "2014-01-01",
            "slug": "best2014",
            "forcefields": ["AMBER03*","AMBER03W","AMBER03WS"]
        },
        {
            "type": "paper",
            "name": "Debiec et al. (2014)",
            "url": "...",
            "title": "Evaluating the Strength of Salt Bridges: A Comparison of Current Biomolecular Force Fields",
            "journal": "...",
            "description": "...",
            "ditem": 16,
            "date": "2014-01-01",
            "slug": "debiec2014",
            "forcefields": ["AMBER99SB-ILDN", "AMBER03", "AMBER13α", "CHARMM22-CMAP","CHARMM22*","OPLS_2005"]
        },
        {
            "type": "paper",
            "name": "Rauscher et al. (2015)",
            "url": "...",
            "title": "Structural Ensembles of Intrinsically Disordered Proteins Depend Strongly on Force Field: A Comparison to Experiment",
            "journal": "...",
            "description": "...",
            "ditem": 17,
            "date": "2015-01-01",
            "slug": "rauscher2015",
            "forcefields": ["AMBER99SB*-ILDN", "AMBER03W", "AMBER03WS", "CHARMM22*", "CHARMM36"]
        },
        {
            "type": "paper",
            "name": "Mercadante et al. (2015)",
            "url": "...",
            "title": "Kirkwood−Buff Approach Rescues Overcollapse of a Disordered Protein in Canonical Protein Force Fields",
            "journal": "...",
            "description": "...",
            "ditem": 18,
            "date": "2015-01-01",
            "slug": "mercadante2015",
            "forcefields": ["OPLS-AA/L","AMBER99SB*-ILDN","CHARMM22*","GROMOS54a7"]
        },
        {
            "type": "paper",
            "name": "Smith et al. (2015)",
            "url": "...",
            "title": "Force-Field Induced Bias in the Structure of Aβ21−30: A Comparison of OPLS, AMBER, CHARMM, and GROMOS Force Fields",
            "journal": "...",
            "description": "...",
            "ditem": 19,
            "date": "2015-01-01",
            "slug": "smith2015",
            "forcefields": ["OPLS-AA/L","AMBER99SB-ILDN","AMBER03","AMBER99SB","AMBER99","CHARMM22-CMAP","GROMOS53a6"]
        },
        {
            "type": "paper",
            "name": "Best et al. (2015)",
            "url": "...",
            "title": "Quantitative Interpretation of FRET Experiments via Molecular Simulation: Force Field and Validation",
            "journal": "...",
            "description": "...",
            "ditem": 20,
            "date": "2015-01-01",
            "slug": "best2015",
            "forcefields": ["AMBER03*","AMBER03W","AMBER03WS","AMBER99SBWS"]
        },
        {
            "type": "paper",
            "name": "Chen et al. (2015)",
            "url": "...",
            "title": "Conformational Dynamics of Two Natively Unfolded Fragment Peptides: Comparison of the AMBER and CHARMM Force Fields",
            "journal": "...",
            "description": "...",
            "ditem": 21,
            "date": "2015-01-01",
            "slug": "best2015",
            "forcefields": ["AMBER99SB-ILDN","CHARMM22-CMAP","CHARMM36"]
        },
        {
            "type": "paper",
            "name": "Henriques et al. (2015)",
            "url": "...",
            "title": "Molecular Dynamics Simulations of Intrinsically Disordered Proteins: Force Field Evaluation and Comparison with Experiment",
            "journal": "...",
            "description": "...",
            "ditem": 22,
            "date": "2015-01-01",
            "slug": "best2015",
            "forcefields": ["AMBER99SB-ILDN","AMBER99SB-ILDN-NMR","GROMOS53a6","GROMOS54a7"]
        },
        {
            "type": "paper",
            "name": "Martín-García et al. (2015)",
            "url": "...",
            "title": "Comparing Molecular Dynamics Force Fields in the Essential Subspace",
            "journal": "...",
            "description": "...",
            "ditem": 23,
            "date": "2015-01-01",
            "slug": "martingarcia2015",
            "forcefields": ["CHARMM22*","CHARMM22-CMAP","AMBER03","AMBER03*","AMBER99SB*-ILDN","AMBER99SB-ILDN","OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Debiec et al. (2016)",
            "url": "...",
            "title": "Further along the Road Less Traveled: AMBER ff15ipq, an Original Protein Force Field Built on a Self-Consistent Physical Model",
            "journal": "...",
            "description": "...",
            "ditem": 24,
            "date": "2016-01-01",
            "slug": "debiec2015",
            "forcefields": ["AMBER14SB", "AMBER03", "AMBER14ipq", "CHARMM22-CMAP","CHARMM22*","CHARMM36","AMBER15ipq","DRUDE-2013","AMOEBA","OPLS_2005"]
        },
        {
            "type": "paper",
            "name": "Marzinek et al. (2016)",
            "url": "...",
            "title": "Characterizing the Conformational Landscape of Flavivirus Fusion Peptides via Simulation and Experiment",
            "journal": "...",
            "description": "...",
            "ditem": 25,
            "date": "2016-01-01",
            "slug": "marzinek2016",
            "forcefields": ["AMBER99SB*-ILDN-Q","CHARMM22-CMAP","OPLS-AA/L","GROMOS54a7","CHARMM36"]
        },
        {
            "type": "paper",
            "name": "Huang et al. (2017)",
            "url": "...",
            "title": "charmm36m: an improved force field for folded and intrinsically disordered proteins",
            "journal": "...",
            "description": "...",
            "ditem": 26,
            "date": "2017-01-01",
            "slug": "huang2017",
            "forcefields": ["CHARMM36","CHARMM36M"]
        },
        {
            "type": "paper",
            "name": "Miller et al. (2017)",
            "url": "...",
            "title": "Reparametrization of Protein Force Field Nonbonded Interactions Guided by Osmotic Coefficient Measurements from Molecular Dynamics Simulations",
            "journal": "...",
            "description": "...",
            "ditem": 27,
            "date": "2017-01-01",
            "slug": "miller2017",
            "forcefields": ["AMBER99SB-ILDN","CHARMM36","OPLS-AA/L","GROMOS54a7"]
        },
        {
            "type": "paper",
            "name": "Siwy et al. (2017)",
            "url": "...",
            "title": "Is the Conformational Ensemble of Alzheimer’s Aβ10-40 Peptide Force Field Dependent?",
            "journal": "...",
            "description": "...",
            "ditem": 28,
            "date": "2017-01-01",
            "slug": "siwy2017",
            "forcefields": ["CHARMM36","CHARMM22*","CHARMM22-CMAP","OPLS-AA/L"]
        },
        {
            "type": "paper",
            "name": "Sandoval-Perez et al. (2017)",
            "url": "...",
            "title": "Critical Comparison of Biomembrane Force Fields: Protein−Lipid Interactions at the Membrane Interface",
            "journal": "...",
            "description": "...",
            "ditem": 29,
            "date": "2017-01-01",
            "slug": "sandovalperez2017",
            "forcefields": ["GROMOS54a7", "CHARMM36", "AMBER14SB"]
        },
        {
            "type": "paper",
            "name": "Wang et al. (2017)",
            "url": "...",
            "title": "Building a More Predictive Protein Force Field: A Systematic and Reproducible Route to AMBER-FB15",
            "journal": "...",
            "description": "...",
            "ditem": 30,
            "date": "2017-01-01",
            "slug": "wang2017",
            "forcefields": ["AMBER-FB15", "AMBER99SB-NMR", "AMBER99SB-ILDN", "AMBER03", "AMBER99SB"]
        }
      ]
}

// transform the data into a useful representation
// 1 is inner, 2, is outer

// need: inner, outer, links
//
// inner:
// links: { inner: outer: }


var outer = d3.map();
var inner = [];
var links = [];

var outerId = [0];

rawdata["papers"].forEach(function(d){

       if (d == null)
           return;

       i = { id: 'i' + inner.length, name: d["name"],
             title: d["title"], url: d["url"],
             journal: d["journal"], description: d["description"],
             related_links: [] };

       i.related_nodes = [i.id];
       inner.push(i);

       if (!Array.isArray(d["forcefields"]))
           d["forcefields"] = [d["forcefields"]];

       d["forcefields"].forEach(function(d1){
           o = outer.get(d1);

           if (o == null)
           {
               o = { name: d1,    id: 'o' + outerId[0], related_links: [] };
               o.related_nodes = [o.id];
               outerId[0] = outerId[0] + 1;

               outer.set(d1, o);
           }

           // create the links
           l = { id: 'l-' + i.id + '-' + o.id, inner: i, outer: o }
           links.push(l);

           // and the relationships
           i.related_nodes.push(o.id);
           i.related_links.push(l.id);
           o.related_nodes.push(i.id);
           o.related_links.push(l.id);
       });
});

data = {
    inner: inner,
    outer: outer.values(),
    links: links
}

//data.outer = data.outer.sort()
data.outer.sort(function(a, b){
    if(a.name < b.name) return -1;
    if(a.name > b.name) return 1;
    return 0;
})
// sort the data -- TODO: have multiple sort options
//outer = data.outer;
//data.outer = Array(outer.length);


//var i1 = 0;
//var i2 = outer.length - 1;

//for (var i = 0; i < data.outer.length; ++i)
//{
//    if (i % 2 == 1)
//        data.outer[i2--] = outer[i];
//    else
//        data.outer[i1++] = outer[i];
//}

console.log(data.outer.reduce(function(a,b) { return a + b.related_links.length; }, 0) / data.outer.length);


// from d3 colorbrewer:
// This product includes color specifications and designs developed by Cynthia Brewer (http://colorbrewer.org/).
var colors = ["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]
var color = d3.scale.linear()
    .domain([60, 220])
    .range([colors.length-1, 0])
    .clamp(true);

var diameter = 960;
var rect_width = 180;
var rect_height = 14;

var link_width = "1px";

var il = data.inner.length;
var ol = data.outer.length;

var inner_y = d3.scale.linear()
    .domain([0, il])
    .range([-(il * rect_height)/2, (il * rect_height)/2]);

mid = (data.outer.length/2.0)
var outer_x = d3.scale.linear()
    .domain([0, mid, mid, data.outer.length])
    .range([15, 170, 190 ,355]);

var outer_y = d3.scale.linear()
    .domain([0, data.outer.length])
    .range([0, diameter / 2 - 120]);


// setup positioning
data.outer = data.outer.map(function(d, i) {
    d.x = outer_x(i);
    d.y = diameter/2.5;
    return d;
});

data.inner = data.inner.map(function(d, i) {
    d.x = -(rect_width / 2);
    d.y = inner_y(i);
    return d;
});

function get_color_ff(name)
{
    if (name.indexOf("CHARMM") !=-1) {
      return '#d7191c';
    } else if (name.indexOf("GROMOS") !=-1) {
      return '#fdae61'
    } else if (name.indexOf("OPLS") !=-1) {
      return '#2b83ba'
    } else if (name.indexOf("AMBER") !=-1) {
      return '#abdda4'
    } else {
      return '#ffffbf';    // fallback color
    }
}

function get_color(name)
{
    var c = Math.round(color(name));
    if (isNaN(c))
        return '#dddddd';    // fallback color

    return colors[c];
}

// Can't just use d3.svg.diagonal because one edge is in normal space, the
// other edge is in radial space. Since we can't just ask d3 to do projection
// of a single point, do it ourselves the same way d3 would do it.


function projectX(x)
{
    return ((x - 90) / 180 * Math.PI) - (Math.PI/2);
}

var diagonal = d3.svg.diagonal()
    .source(function(d) { return {"x": d.outer.y * Math.cos(projectX(d.outer.x)),
                                  "y": -d.outer.y * Math.sin(projectX(d.outer.x))}; })
    .target(function(d) { return {"x": d.inner.y + rect_height/2,
                                  "y": d.outer.x > 180 ? d.inner.x : d.inner.x + rect_width}; })
    .projection(function(d) { return [d.y, d.x]; });


var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
  .append("g")
    .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");


// links
var link = svg.append('g').attr('class', 'links').selectAll(".link")
    .data(data.links)
  .enter().append('path')
    .attr('class', 'link')
    .attr('id', function(d) { return d.id })
    .attr("d", diagonal)
    .attr('stroke', function(d) { return get_color_ff(d.outer.name); })
    .attr('stroke-width', link_width);

// outer nodes

var onode = svg.append('g').selectAll(".outer_node")
    .data(data.outer)
  .enter().append("g")
    .attr("class", "outer_node")
    .attr("transform", function(d) { return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")"; })
    .on("mouseover", mouseover)
    .on("mouseout", mouseout);

onode.append("circle")
    .attr('id', function(d) { return d.id })
    .attr("r", 4.5);

onode.append("circle")
    .attr('r', 20)
    //.attr('stroke', function(d) { return get_color_ff(d.outer.name); })
    .attr('visibility', 'hidden');

onode.append("text")
    .attr('id', function(d) { return d.id + '-txt'; })
    .attr("dy", ".31em")
    .attr('stroke', function(d) { return get_color_ff(d.name); })
    .attr("text-anchor", function(d) { return d.x < 180 ? "start" : "end"; })
    .attr("transform", function(d) { return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)"; })
    .text(function(d) { return d.name; });

// inner nodes

var inode = svg.append('g').selectAll(".inner_node")
    .data(data.inner)
  .enter().append("g")
    .attr("class", "inner_node")
    .attr("transform", function(d, i) { return "translate(" + d.x + "," + d.y + ")"})
    .on("mouseover", mouseover)
    .on("mouseout", mouseout);

inode.append("a")
    .attr("xlink:href", function(d) { return d.url; })
    .append("rect")
    .attr('width', rect_width)
    .attr('height', rect_height)
    .attr('id', function(d) { return d.id; })
    .attr('fill', function(d) { return get_color(d.name); });

inode.append("text")
    .attr('id', function(d) { return d.id + '-txt'; })
    .attr('text-anchor', 'middle')
    .attr("transform", "translate(" + rect_width/2 + ", " + rect_height * .75 + ")")
    .text(function(d) { return d.name; });

// need to specify x/y/etc

d3.select(self.frameElement).style("height", diameter - 150 + "px");

function mouseover(d)
{
    // bring to front
    d3.selectAll('.links .link').sort(function(a, b){ return d.related_links.indexOf(a.id); });

    for (var i = 0; i < d.related_nodes.length; i++)
    {
        d3.select('#' + d.related_nodes[i]).classed('highlight', true);
        d3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'bold');
    }

    for (var i = 0; i < d.related_links.length; i++)
        d3.select('#' + d.related_links[i]).attr('stroke-width', '5px');
}

function mouseout(d)
{
    for (var i = 0; i < d.related_nodes.length; i++)
    {
        d3.select('#' + d.related_nodes[i]).classed('highlight', false);
        d3.select('#' + d.related_nodes[i] + '-txt').attr("font-weight", 'normal');
    }

    for (var i = 0; i < d.related_links.length; i++)
        d3.select('#' + d.related_links[i]).attr('stroke-width', link_width);
}

</script>
